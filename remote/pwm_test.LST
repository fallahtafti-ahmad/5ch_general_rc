"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 1



;  57: {
  57  0000              __stm0ah EQU [02dH]
  57  0000              __stm0al EQU [02cH]
  57  0000              __stm0dh EQU [02bH]
  57  0000              __stm0dl EQU [02aH]
  57  0000              __stm0c1 EQU [029H]
  57  0000              __stm0c0 EQU [028H]
  57  0000              __pasr EQU [026H]
  57  0000              __rstc EQU [025H]
  57  0000              __sadc2 EQU [024H]
  57  0000              __sadc1 EQU [023H]
  57  0000              __sadc0 EQU [022H]
  57  0000              __sadoh EQU [021H]
  57  0000              __sadol EQU [020H]
  57  0000              __eed EQU [01fH]
  57  0000              __eea EQU [01eH]
  57  0000              __smod1 EQU [01cH]
  57  0000              __tbc EQU [01bH]
  57  0000              __wdtc EQU [019H]
  57  0000              __ifs0 EQU [018H]
  57  0000              __pawu EQU [017H]
  57  0000              __papu EQU [016H]
  57  0000              __pac EQU [015H]
  57  0000              __pa EQU [014H]
  57  0000              __mfi0 EQU [011H]
  57  0000              __intc1 EQU [0fH]
  57  0000              __intc0 EQU [0eH]
  57  0000              __integ EQU [0dH]
  57  0000              __smod EQU [0bH]
  57  0000              __status EQU [0aH]
  57  0000              __tblh EQU [08H]
  57  0000              __tblp EQU [07H]
  57  0000              __pcl EQU [06H]
  57  0000              __acc EQU [05H]
  57  0000              __bp EQU [04H]
  57  0000              __mp1 EQU [03H]
  57  0000              __iar1 EQU [02H]
  57  0000              __mp0 EQU [01H]
  57  0000              __iar0 EQU [00H]
  57  0000              @MAIN .SECTION 'CODE'
  57  0000              _main PROC
  57  0000              begin:

;  58: 	_ws0=1;
  58  0000  3019        SET [019H].0

;  59: 	_ws1=1;
  59  0001  3099        SET [019H].1

;  60: 	_ws2=1;
  60  0002  3119        SET [019H].2

;  63: 	_pawu6=1;
  63  0003  3317        SET [017H].6

;  64: 	_pawu7=1;
  64  0004  3397        SET [017H].7
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 2 


;  65: 	_pawu1=1;
  65  0005  3097        SET [017H].1

;  66: 	_pawu0=1;
  66  0006  3017        SET [017H].0

;  68: 	_pac6=1;
  68  0007  3315        SET [015H].6

;  69: 	_papu6=1;
  69  0008  3316        SET [016H].6

;  70: 	_pac7=1;
  70  0009  3395        SET [015H].7

;  71: 	_papu7=1;
  71  000A  3396        SET [016H].7

;  72: 	_pac1=1;
  72  000B  3095        SET [015H].1

;  73: 	_pac0=1;
  73  000C  3015        SET [015H].0

;  74: 	_papu1=1;
  74  000D  3096        SET [016H].1

;  75: 	_papu0=1;
  75  000E  3016        SET [016H].0

;  78: 	STM_Init();
  78  000F  2000     E  CALL _STM_Init

;  80: 	g_nCCRA = 105;	//PWM duty set 128
  80  0010  0F00     R  MOV A,BANK _g_nCCRA
  80  0011  0084        MOV [04H],A
  80  0012  0F00     R  MOV A,OFFSET _g_nCCRA
  80  0013  0083        MOV [03H],A
  80  0014  0F69        MOV A,069h
  80  0015  0082        MOV [02H],A
  80  0016  1483        INC [03H]
  80  0017  1F02        CLR [02H]

;  81: 	g_nCCRP = 2;	//PWM period set 4*128
  81  0018  0F00     R  MOV A,BANK _g_nCCRP
  81  0019  0084        MOV [04H],A
  81  001A  0F00     R  MOV A,OFFSET _g_nCCRP
  81  001B  0083        MOV [03H],A
  81  001C  0F02        MOV A,02h
  81  001D  0082        MOV [02H],A
  81  001E  1483        INC [03H]
  81  001F  1F02        CLR [02H]

;  93: 	STM_CompareMatchOutputConfig();
  93  0020  2000     E  CALL _STM_CompareMatchOutputConfig

;  94: 	STM_CompareMatchOutputUpdate(g_nCCRA);
  94  0021  0F00     R  MOV A,BANK _g_nCCRA
  94  0022  0084        MOV [04H],A
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 3 

  94  0023  0F00     R  MOV A,OFFSET _g_nCCRA
  94  0024  0083        MOV [03H],A
  94  0025  0702        MOV A,[02H]
  94  0026  0080     E  MOV STM_CompareMatchOutputUpdate0,A
  94  0027  1483        INC [03H]
  94  0028  0702        MOV A,[02H]
  94  0029  0080     E  MOV STM_CompareMatchOutputUpdate0[1],A
  94  002A  2000     E  CALL _STM_CompareMatchOutputUpdate

;  95: 	_delay(20000);	//wait system stable
  95  002B  0F13        MOV A,013H
  95  002C  0080     E  MOV RH,A
  95  002D  0F7D        MOV A,07dH
  95  002E  2000     E  CALL __DELAYY1

;  96: 	_pawu5=1;
  96  002F  3297        SET [017H].5

;  97: 	_pac5=1;
  97  0030  3295        SET [015H].5

;  98: 	_papu5=1;
  98  0031  3296        SET [016H].5
  98  0032  2800     R  JMP L7
  98  0033              L6:

; 102: 		stop=1;
 102  0033  0F00     R  MOV A,BANK _stop
 102  0034  0084        MOV [04H],A
 102  0035  0F00     R  MOV A,OFFSET _stop
 102  0036  0083        MOV [03H],A
 102  0037  0F01        MOV A,1
 102  0038  0082        MOV [02H],A

; 204: 		send_sink();
 204  0039  2000     R  CALL _send_sink

; 205: 		send_sink();
 205  003A  2000     R  CALL _send_sink

; 206: 		if (!fr){
 206  003B  3C14        SZ [014H].0
 206  003C  2800     R  JMP L9

; 207: 			stop=0;
 207  003D  0F00     R  MOV A,BANK _stop
 207  003E  0084        MOV [04H],A
 207  003F  0F00     R  MOV A,OFFSET _stop
 207  0040  0083        MOV [03H],A
 207  0041  1F02        CLR [02H]

; 208: 			r=0;
 208  0042  0F00     R  MOV A,BANK _r
 208  0043  0084        MOV [04H],A
 208  0044  0F00     R  MOV A,OFFSET _r
 208  0045  0083        MOV [03H],A
 208  0046  1F02        CLR [02H]
 208  0047  1483        INC [03H]
 208  0048  1F02        CLR [02H]

; 209: 			send_one();
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 4 

 209  0049  2000     R  CALL _send_one

; 211: 			}else{
 211  004A  2800     R  JMP L10
 211  004B              L9:

; 212: 				send_zero();
 212  004B  2000     R  CALL _send_zero
 212  004C              L10:

; 215: 		if (!fl){
 215  004C  3F14        SZ [014H].6
 215  004D  2800     R  JMP L11

; 216: 			stop=0;
 216  004E  0F00     R  MOV A,BANK _stop
 216  004F  0084        MOV [04H],A
 216  0050  0F00     R  MOV A,OFFSET _stop
 216  0051  0083        MOV [03H],A
 216  0052  1F02        CLR [02H]

; 217: 			r=0;
 217  0053  0F00     R  MOV A,BANK _r
 217  0054  0084        MOV [04H],A
 217  0055  0F00     R  MOV A,OFFSET _r
 217  0056  0083        MOV [03H],A
 217  0057  1F02        CLR [02H]
 217  0058  1483        INC [03H]
 217  0059  1F02        CLR [02H]

; 218: 			send_one();
 218  005A  2000     R  CALL _send_one

; 220: 			}else{
 220  005B  2800     R  JMP L12
 220  005C              L11:

; 221: 				send_zero();
 221  005C  2000     R  CALL _send_zero
 221  005D              L12:

; 224: 		if (!br){
 224  005D  3C94        SZ [014H].1
 224  005E  2800     R  JMP L13

; 225: 			stop=0;
 225  005F  0F00     R  MOV A,BANK _stop
 225  0060  0084        MOV [04H],A
 225  0061  0F00     R  MOV A,OFFSET _stop
 225  0062  0083        MOV [03H],A
 225  0063  1F02        CLR [02H]

; 226: 			r=0;
 226  0064  0F00     R  MOV A,BANK _r
 226  0065  0084        MOV [04H],A
 226  0066  0F00     R  MOV A,OFFSET _r
 226  0067  0083        MOV [03H],A
 226  0068  1F02        CLR [02H]
 226  0069  1483        INC [03H]
 226  006A  1F02        CLR [02H]
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 5 


; 227: 			send_one();
 227  006B  2000     R  CALL _send_one

; 229: 			}else{
 229  006C  2800     R  JMP L14
 229  006D              L13:

; 230: 				send_zero();
 230  006D  2000     R  CALL _send_zero
 230  006E              L14:

; 233: 		if (!bl){
 233  006E  3E94        SZ [014H].5
 233  006F  2800     R  JMP L15

; 234: 			stop=0;
 234  0070  0F00     R  MOV A,BANK _stop
 234  0071  0084        MOV [04H],A
 234  0072  0F00     R  MOV A,OFFSET _stop
 234  0073  0083        MOV [03H],A
 234  0074  1F02        CLR [02H]

; 235: 			r=0;
 235  0075  0F00     R  MOV A,BANK _r
 235  0076  0084        MOV [04H],A
 235  0077  0F00     R  MOV A,OFFSET _r
 235  0078  0083        MOV [03H],A
 235  0079  1F02        CLR [02H]
 235  007A  1483        INC [03H]
 235  007B  1F02        CLR [02H]

; 236: 			send_one();
 236  007C  2000     R  CALL _send_one

; 238: 			}else{
 238  007D  2800     R  JMP L16
 238  007E              L15:

; 239: 				send_zero();
 239  007E  2000     R  CALL _send_zero
 239  007F              L16:

; 242: 		if (!h){
 242  007F  3F94        SZ [014H].7
 242  0080  2800     R  JMP L17

; 243: 			stop=0;
 243  0081  0F00     R  MOV A,BANK _stop
 243  0082  0084        MOV [04H],A
 243  0083  0F00     R  MOV A,OFFSET _stop
 243  0084  0083        MOV [03H],A
 243  0085  1F02        CLR [02H]

; 244: 			r=0;
 244  0086  0F00     R  MOV A,BANK _r
 244  0087  0084        MOV [04H],A
 244  0088  0F00     R  MOV A,OFFSET _r
 244  0089  0083        MOV [03H],A
 244  008A  1F02        CLR [02H]
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 6 

 244  008B  1483        INC [03H]
 244  008C  1F02        CLR [02H]

; 245: 			send_one();
 245  008D  2000     R  CALL _send_one

; 247: 			}else{
 247  008E  2800     R  JMP L18
 247  008F              L17:

; 248: 				send_zero();
 248  008F  2000     R  CALL _send_zero
 248  0090              L18:

; 252: 		_delay(200000);
 252  0090  0FC2        MOV A,0c2H
 252  0091  0080     E  MOV RH,A
 252  0092  0FED        MOV A,0edH
 252  0093  2000     E  CALL __DELAYY3

; 255: 		if(stop){
 255  0094  0F00     R  MOV A,BANK _stop
 255  0095  0084        MOV [04H],A
 255  0096  0F00     R  MOV A,OFFSET _stop
 255  0097  0083        MOV [03H],A
 255  0098  1082        SZ [02H]
 255  0099  2800     R  JMP L23
 255  009A  2800     R  JMP L19
 255  009B              L23:

; 256: 		if(r<3){
 256  009B  0F00     R  MOV A,BANK _r
 256  009C  0084        MOV [04H],A
 256  009D  0F00     R  MOV A,OFFSET _r
 256  009E  0083        MOV [03H],A
 256  009F  0702        MOV A,[02H]
 256  00A0  0080     R  MOV b0_1,A
 256  00A1  1483        INC [03H]
 256  00A2  0702        MOV A,[02H]
 256  00A3  0080     R  MOV b0_1[1],A
 256  00A4  0F80        MOV A,80h
 256  00A5  0400     R  XOR A,b0_1[1]
 256  00A6  0080     E  MOV RH,A
 256  00A7  0F80        MOV A,080h
 256  00A8  0200     E  SUB A,RH
 256  00A9  380A        SNZ [0AH].0
 256  00AA  2800     R  JMP L21
 256  00AB  390A        SNZ [0AH].2
 256  00AC  2800     R  JMP L24
 256  00AD  0700     R  MOV A,b0_1
 256  00AE  0A03        SUB A,03h
 256  00AF  3C0A        SZ [0AH].0
 256  00B0  2800     R  JMP L21
 256  00B1              L24:

; 257: 		r++;
 257  00B1  0F00     R  MOV A,BANK _r
 257  00B2  0084        MOV [04H],A
 257  00B3  0F00     R  MOV A,OFFSET _r
 257  00B4  0083        MOV [03H],A
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 7 

 257  00B5  0F01        MOV A,01h
 257  00B6  0382        ADDM A,[02H]
 257  00B7  0F00        MOV A,00h
 257  00B8  1483        INC [03H]
 257  00B9  1382        ADCM A,[02H]

; 280: 			}else{
 280  00BA  2800     R  JMP L22
 280  00BB              L21:

; 281: 		_idlen=0;
 281  00BB  348B        CLR [0BH].1

; 282: 		_wdtc=175;
 282  00BC  0FAF        MOV A,0afh
 282  00BD  0099        MOV __wdtc,A

; 283: 		_halt();
 283  00BE  0002        HALT

; 284: 		_delay(240000);
 284  00BF  0FE9        MOV A,0e9H
 284  00C0  0080     E  MOV RH,A
 284  00C1  0FEA        MOV A,0eaH
 284  00C2  2000     E  CALL __DELAYY1

; 285: 		_wdtc=80;
 285  00C3  0F50        MOV A,050h
 285  00C4  0099        MOV __wdtc,A
 285  00C5              L22:
 285  00C5              L19:

; 290: 		_clrwdt();
 290  00C5  0001        CLR WDT
 290  00C6              L7:

; 100: 	while(1)
 100  00C6  2800     R  JMP L6
 100  00C7              L5:

; 293: }
 293  00C7  2800     R  JMP $
 293  0000  0002[       LOCAL b0_1 DB 2 DUP(?)
            00
            ]
 293  00C8              _main ENDP

; 294: void send_one(void){
 294  0000              @send_one .SECTION 'CODE'
 294  0000              PUBLIC _send_one
 294  0000              _send_one PROC

; 295: 		STM_ENABLE();
 295  0000  31A8        SET [028H].3

; 296: 		_delay(13000);
 296  0001  0F0C        MOV A,0cH
 296  0002  0080     E  MOV RH,A
 296  0003  0FAA        MOV A,0aaH
 296  0004  2000     E  CALL __DELAYY3
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 8 


; 297: 		STM_DISABLE();
 297  0005  35A8        CLR [028H].3

; 298: 		_delay(3000);
 298  0006  0F02        MOV A,02H
 298  0007  0080     E  MOV RH,A
 298  0008  0FEB        MOV A,0ebH
 298  0009  2000     E  CALL __DELAYY3
 298  000A              L25:
 298  000A  0003        RET
 298  000B              _send_one ENDP

; 300: void send_zero(void){
 300  0000              @send_zero .SECTION 'CODE'
 300  0000              PUBLIC _send_zero
 300  0000              _send_zero PROC

; 301: 		STM_ENABLE();
 301  0000  31A8        SET [028H].3

; 302: 		_delay(8000);
 302  0001  0F07        MOV A,07H
 302  0002  0080     E  MOV RH,A
 302  0003  0FCB        MOV A,0cbH
 302  0004  2000     E  CALL __DELAYY1

; 303: 		STM_DISABLE();
 303  0005  35A8        CLR [028H].3

; 304: 		_delay(3000);
 304  0006  0F02        MOV A,02H
 304  0007  0080     E  MOV RH,A
 304  0008  0FEB        MOV A,0ebH
 304  0009  2000     E  CALL __DELAYY3
 304  000A              L26:
 304  000A  0003        RET
 304  000B              _send_zero ENDP

; 306: void send_sink(void){
 306  0000              @send_sink .SECTION 'CODE'
 306  0000              PUBLIC _send_sink
 306  0000              _send_sink PROC

; 307: 		STM_ENABLE();
 307  0000  31A8        SET [028H].3

; 308: 		_delay(4000);
 308  0001  0F03        MOV A,03H
 308  0002  0080     E  MOV RH,A
 308  0003  0FE5        MOV A,0e5H
 308  0004  2000     E  CALL __DELAYY1

; 309: 		STM_DISABLE();
 309  0005  35A8        CLR [028H].3

; 310: 		_delay(3000);
 310  0006  0F02        MOV A,02H
 310  0007  0080     E  MOV RH,A
 310  0008  0FEB        MOV A,0ebH
"File: pwm_test.c    Holtek Cross-Assembler  Version 3.00      Page 9 

 310  0009  2000     E  CALL __DELAYY3
 310  000A              L27:
 310  000A  0003        RET
 310  000B              _send_sink ENDP
 310  000B              EXTERN STM_CompareMatchOutputUpdate0:BYTE

;  44: u16	g_nCCRP ;		
  44  000B              PUBLIC _g_nCCRP
  44  0000              @g_nCCRP .SECTION 'DATA'
  44  0000  0002[       _g_nCCRP DB 2 DUP (?) ;g_nCCRP
            00
            ]

;  43: u16	g_nCCRA ;		
  43  0002              PUBLIC _g_nCCRA
  43  0000              @g_nCCRA .SECTION 'DATA'
  43  0000  0002[       _g_nCCRA DB 2 DUP (?) ;g_nCCRA
            00
            ]

;  42: int r;
  42  0002              PUBLIC _r
  42  0000              @r .SECTION 'DATA'
  42  0000  0002[       _r DB 2 DUP (?) ;r
            00
            ]

;  41: bool stop;
  41  0002              PUBLIC _stop
  41  0000              @stop .SECTION 'DATA'
  41  0000  00          _stop DB ? ; stop
  41  0001              EXTERN _STM_CompareMatchOutputUpdate:NEAR
  41  0001              EXTERN _STM_CompareMatchOutputConfig:NEAR
  41  0001              EXTERN _STM_Init:NEAR

;  56: void main()
  56  0000              STARTSEC .SECTION  COM_L 'CODE'
  56  0000              STARTUP:
  56  0000              STARTSEC .SECTION  COM_E 'CODE'
  56  0000  0003        RET
  56  0001              EXTERN RH:BYTE
  56  0001              EXTERN __DELAYY0:NEAR
  56  0001              EXTERN __DELAYY1:NEAR
  56  0001              EXTERN __DELAYY2:NEAR
  56  0001              EXTERN __DELAYY3:NEAR
  56  0001              EXTERN __DELAYY4:NEAR
  56  0001              EXTERN __DELAYY5:NEAR
  56  0000              @CODE .SECTION AT 0 'CODE'
  56  0000  2000     R  CALL STARTUP
  56  0001  2800     R  JMP begin
  56  0002              @DUMMY PROC
  56  0002  2000     R  CALL _main
  56  0003              @DUMMY ENDP


        0 Errors
